\chapter{Audyt}
Niniejszy rozdzia³ skupia siê na wykonaniu testów bezpieczeñstwa. Przeprowadzany audyt jest rodzajem bia³ej skrzynki, czyli podczas jego trwania audytor posiada pe³en wgl¹d w kod Ÿród³owy badanego obiektu i inne poufne informacje. Wyniki zostan¹ przeanalizowane pod k¹tem mo¿liwoœci wprowadzenia zmian w aplikacji zwiêkszaj¹cych jej bezpieczeñstwo.\section{Przygotowanie œrodowiska}
Audyt zostanie przeprowadzony w œrodowisku sk³adaj¹cym siê z dwóch urz¹dzeñ bêd¹cych w~jednej podsieci oraz routera. Jeden z komputerów obs³uguje system Windows 10 z uruchomion¹ aplikacjê i bêdzie pe³ni³ funkcjê atakowanego obiektu. Drugi zaœ ma zainstalowany system operacyjny Kali Linux i pos³u¿y za stronê atakuj¹c¹. Adresy IP oraz sposoby komunikacji urz¹dzeñ pokazano na rysunku~\ref{fig:Rys04/srodowisko}.

\begin{figure}[htb]
\centering
\includegraphics[scale=0.8]{Rys04/srodowisko}
\caption{Œrodowisko audytu}
\label{fig:Rys04/srodowisko}
\end{figure}
 
\section{Przeprowadzenie audytu}
\subsection{Skan narzêdziem SQL Map}
Czêœæ audytu przeprowadzona narzêdziem SQL Map
Na wstêpie przeskanowano g³ówn¹ stronê w poszukiwaniu parametrów GET, które mo¿na by³oby wykorzystaæ do ataku SQL Injection (rys.~\ref{fig:Rys04/SQLMap1.png}).

\begin{figure}[htb]
\centering
\includegraphics[scale=0.9]{Rys04/SQLMap1.png}
\caption{Wynik komendy \texttt{sqlmap -u 192.168.1.46:4449/}}
\label{fig:Rys04/SQLMap1.png}
\end{figure}

Narzêdzie nie znalaz³o ¿adnego parametru, lecz zaleci³o uruchomienie komendy ponownie z prze³¹czk¹ crawl (okreœla jak g³êboko skanuje podstrony)  o wartoœci 2. Przeszukuje ona podstrony w celu znalezienia parametrów GET, do których mo¿na siê dostaæ przez stronê napisan¹ w komendzie. W tym przypadku jest to strona g³ówna. W dalszej kolejnoœci wybrano opcjê, aby sprawdziæ pliki .xml (je¿eli znajdzie) oraz liczbê w¹tków. Finalnie skan nie znalaz³ ¿adnej podatnoœci (rys.~\ref{fig:Rys04/SQLMap2.png}). Nie uda³o siê zlokalizowaæ parametrów GET do wykonania ataku. W~nastêpnej czêœci wykonane zostan¹ próby poszukania parametrów POST.

%\newpage
\begin{figure}[htb]
\centering
\includegraphics[scale=0.9]{Rys04/SQLMap2.png}
\caption{Wynik komendy \texttt{sqlmap -u 192.168.1.46:4449/ --crawl=2}}
\label{fig:Rys04/SQLMap2.png}
\end{figure}

W celu przetestowania funkcjonalnoœci logowania siê, zdecydowano siê na u¿ycie interaktywnego kreatora. Za jego pomoc¹ wpisuje siê wszystkie podstawowe, wymagane informacje potrzebne do przeprowadzenia skanu np. adres URL (ang.~\emph{Uniform Resource Locator}) oraz wybiera siê pule ataków, które maj¹ zostaæ przeprowadzone (rys.~\ref{fig:Rys04/SQLMap4.png}). W trakcie jego wykonywania mo¿na zobaczyæ jak wiele ¿¹dañ POST jest wysy³anych w bardzo w¹skim zakresie czasu (rys.~\ref{Rys04/console.png}). Przy skanowaniu nie wykryto podatnoœci.

\begin{figure}[htb]
\centering
\includegraphics[scale=0.7]{Rys04/SQLMap4.png}
\caption{Wynik komendy \texttt{sqlmap -wizard}}
\label{fig:Rys04/SQLMap4.png}
\end{figure}

\begin{figure}[htb]
\centering
\includegraphics[scale=0.52]{Rys04/console.png}
\caption{Konsola aplikacji}
\label{Rys04/console.png}
\end{figure}

Nastêpne skany maj¹ na celu sprawdzenie metodê rejestrowania siê. Podobnie jak w przypadku wczeœniejszego testowania funkcjonalnoœci zdecydowano siê na u¿ycie kreatora. Wszystkie parametry ustawiano tak samo, z wyj¹tkiem adresu URL (rys.~\ref{fig:Rys04/SQLMap3.png}). Podczas wykonywania testów aplikacja przesta³a dzia³aæ i wyœwietli³a komunikat pokazany na rysunku (rys.~\ref{Rys04/error.png}).  B³¹d jest spowodowanym prób¹ utworzenia dwóch u¿ytkowników o takim samym loginie. Wracaj¹c do modelu bazy danych mo¿na zaobserwowaæ, i¿ ka¿dy u¿ytkownik powinien posiadaæ unikaln¹ nazwê loginu. Uniemo¿liwi³ on dokoñczenie sprawdzania funkcjonalnoœci przed innymi podatnoœciami. 

\begin{figure}[htb]
\centering
\includegraphics[scale=0.63]{Rys04/SQLMap3.png}
\caption{Wynik komendy \texttt{sqlmap -wizard}}
\label{fig:Rys04/SQLMap3.png}
\end{figure}

\begin{figure}[htb]
\centering
\includegraphics[scale=1.3]{Rys04/error.png}
\caption{B³¹d w kodzie aplikacji}
\label{Rys04/error.png}
\end{figure}

\subsection{Skan narzêdziem Metasploit}
Kolejnym narzêdziem wykorzystanym przy audycie jest Metasploit. Na wstêpie u¿yto plugin WMAP, który jest paczk¹ podatnoœci wykorzystywan¹ do testowania webowych aplikacji. Za³adowano go, a nastêpnie ustawiono URL strony oraz podstron, które zostan¹ zaatakowane i na koñcu uruchomiono skan (rys.~\ref{Rys04/Metasploit1.png}). W konsoli aplikacji zaobserwowano bardzo du¿y przyp³yw ¿¹dañ (rys.~\ref{Rys04/console2.png}).

\newpage
\begin{figure}[htb]
\centering
\includegraphics[scale=0.8]{Rys04/Metasploit1.png}
\caption{Konfiguracja WMAPa}
\label{Rys04/Metasploit1.png}
\end{figure}

\begin{figure}[htb]
\centering
\includegraphics[scale=0.52]{Rys04/console2.png}
\caption{Konsola aplikacji}
\label{Rys04/console2.png}
\end{figure}

Na koñcuwybrano exploit \texttt{scanner/mysql/mysql\_login} w celu odgadniêcia loginu i has³a do us³ugi bazy danych MySQL. Na rysunku~\ref{Rys04/Metasploit2.png} pokazano skonfigurowany poprawnie atak. Plik \texttt{rockyou.txt} zawiera listê najczêœcniej wykorzystywanych wyrazów jako login lub has³o. Kolejny ekranu pokazuje próbê uruchomienia exploita, która zakoñczy³a siê niepowodzeniem (rys~\ref{Rys04/Metasploit3.png}).

\begin{figure}[htb]
\centering
\includegraphics[scale=0.7]{Rys04/Metasploit2.png}
\caption{Konfiguracja WMAPa}
\label{Rys04/Metasploit2.png}
\end{figure}

\begin{figure}[htb]
\centering
\includegraphics[scale=0.7]{Rys04/Metasploit3.png}
\caption{Wynik pluginu WMAP}
\label{Rys04/Metasploit3.png}
\end{figure}

\section{Analiza znalezionych podatnoœci}
Na podstawie wykonanego audytu zlokalizowano kilka s³aboœci aplikacji. Dla funkcji logowania nie znaleziono podatnoœci, natomiast nie posiada ona limitu logowañ na dany zakres czasu. Nara¿a j¹ to na przyjmowanie bardzo du¿ej iloœci ¿¹dañ w krótkim okresie czasu, co mo¿e spowodowaæ zwolnienie dzia³ania lub jej ca³kowite wy³¹czenie siê. Podczas tworzenia konta nie wszystkie pola posiadaj¹ sprawdzanie poprawnoœci wprowadzonych wartoœci. Dodatkowo funkcja nie weryfikuje, czy u¿ytkownik o wspinanym loginie ju¿ istnieje w bazie. Obie podatnoœci wp³ywaj¹ krytycznie na dzia³anie aplikacji, poniewa¿ j¹ wy³¹czaj¹. 